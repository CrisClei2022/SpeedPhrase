<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login e Cadastro com Appwrite</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }

        .container {
            width: 350px;
            padding: 30px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
            transition: opacity 0.5s ease-in-out;
        }

        h1 {
            text-align: center;
            color: #333;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
        }

        input[type="email"], input[type="password"], input[type="text"] {
            width: 100%;
            height: 40px;
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
        }

        button {
            width: 100%;
            height: 45px;
            background-color: #4CAF50;
            color: #fff;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-top: 10px;
        }

        button:hover {
            background-color: #3e8e41;
        }
        
        #recover-button {
            background-color: #f4a261;
        }

        #recover-button:hover {
            background-color: #e76f51;
        }

        .user-section {
            display: none;
            text-align: center;
        }
        
        #cadastro-section {
            display: none;
        }
        
        #recover-section {
            display: none;
        }

        #welcome-message {
            font-size: 18px;
            font-weight: bold;
            color: #4CAF50;
            margin-bottom: 20px;
        }

        #logout-button {
            background-color: #f44336;
        }

        #logout-button:hover {
            background-color: #da190b;
        }

        .message {
            text-align: center;
            margin-top: 15px;
            font-weight: bold;
        }

        #login-message {
            color: #f44336;
        }

        #cadastro-message, #recover-message {
            color: #4CAF50;
        }
    </style>
</head>
<body>
    <div class="container" id="main-container">

        <div id="login-section">
            <h1>Entrar</h1>
            <form id="login-form">
                <label for="email-login">Email:</label>
                <input type="email" id="email-login" name="email" required>
                <label for="password-login">Senha:</label>
                <input type="password" id="password-login" name="password" required>
                <button type="submit">Entrar</button>
            </form>
            <p class="message" id="login-message"></p>
            <hr style="border: none; border-top: 1px solid #ddd; margin: 20px 0;">
            <p style="text-align: center;">
              Não tem uma conta? <a href="#" id="link-to-signup">Cadastre-se</a>
              <br>
              <br>
              Esqueceu sua senha? <a href="#" id="link-to-recover">Recuperar Senha</a>
            </p>
        </div>

        <div id="cadastro-section">
            <h1>Cadastro</h1>
            <form id="cadastro-form">
                <label for="nome-cadastro">Nome:</label>
                <input type="text" id="nome-cadastro" name="nome" required>
                <label for="email-cadastro">Email:</label>
                <input type="email" id="email-cadastro" name="email" required>
                <label for="senha-cadastro">Senha:</label>
                <input type="password" id="senha-cadastro" name="senha" required>
                <button type="submit">Cadastrar</button>
            </form>
            <p class="message" id="cadastro-message"></p>
            <hr style="border: none; border-top: 1px solid #ddd; margin: 20px 0;">
            <p style="text-align: center;">Já tem uma conta? <a href="#" id="link-to-login">Entrar</a></p>
        </div>

        <div id="recover-section">
            <h1>Recuperar Senha</h1>
            <form id="recover-form">
                <label for="email-recover">Email:</label>
                <input type="email" id="email-recover" name="email" required>
                <button type="submit" id="recover-button">Enviar Link de Recuperação</button>
            </form>
            <p class="message" id="recover-message"></p>
            <hr style="border: none; border-top: 1px solid #ddd; margin: 20px 0;">
            <p style="text-align: center;">Lembrou da sua senha? <a href="#" id="link-to-login-from-recover">Entrar</a></p>
            <p style="text-align: center;">
              Não tem uma conta? <a href="#" id="link-to-signup">Cadastre-se</a></p>
        </div>

        <div id="user-section" class="user-section">
            <p id="welcome-message"></p>
            <button id="logout-button">Sair</button>
        </div>

    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/appwrite@18.2.0"></script>
    <script>
        // Configuração do Appwrite (uma única vez)
        const client = new Appwrite.Client()
            .setEndpoint('https://nyc.cloud.appwrite.io/v1')
            .setProject('689f3d3a00095fde3112');

        const account = new Appwrite.Account(client);

        // Seletores de elementos HTML
        const loginSection = document.getElementById('login-section');
        const cadastroSection = document.getElementById('cadastro-section');
        const recoverSection = document.getElementById('recover-section'); // Nova seção
        const userSection = document.getElementById('user-section');
        
        const loginForm = document.getElementById('login-form');
        const cadastroForm = document.getElementById('cadastro-form');
        const recoverForm = document.getElementById('recover-form'); // Novo formulário
        
        const logoutButton = document.getElementById('logout-button');
        const welcomeMessage = document.getElementById('welcome-message');
        const loginMessage = document.getElementById('login-message');
        const cadastroMessage = document.getElementById('cadastro-message');
        const recoverMessage = document.getElementById('recover-message'); // Nova mensagem

        const linkToSignup = document.getElementById('link-to-signup');
        const linkToLogin = document.getElementById('link-to-login');
        const linkToRecover = document.getElementById('link-to-recover'); // Novo link
        const linkToLoginFromRecover = document.getElementById('link-to-login-from-recover'); // Novo link

        // Função para alternar entre as seções
        function showSection(sectionId) {
            loginSection.style.display = 'none';
            cadastroSection.style.display = 'none';
            recoverSection.style.display = 'none'; // Esconde a nova seção
            userSection.style.display = 'none';
            document.getElementById(sectionId).style.display = 'block';
        }

        // Função para verificar o status de login
        async function checkAuthStatus() {
            try {
                const user = await account.get();
                welcomeMessage.textContent = `Bem-vindo, ${user.name || user.email}!`;
                showSection('user-section');
            } catch (error) {
                showSection('login-section');
            }
        }

        // Evento de submissão do formulário de login
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('email-login').value;
            const password = document.getElementById('password-login').value;

            try {
                loginMessage.textContent = '';
                await account.createEmailPasswordSession(email, password);
                checkAuthStatus(); // Verifica o status após o login
            } catch (error) {
                loginMessage.textContent = 'Erro no login: ' + error.message;
            }
        });

        // Evento de submissão do formulário de cadastro
        cadastroForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const nome = document.getElementById('nome-cadastro').value;
            const email = document.getElementById('email-cadastro').value;
            const senha = document.getElementById('senha-cadastro').value;

            try {
                cadastroMessage.textContent = '';
                await account.create(Appwrite.ID.unique(), email, senha, nome);
                cadastroMessage.textContent = 'Usuário cadastrado com sucesso! Você pode fazer login agora.';
                // Alterna para a seção de login após o cadastro bem-sucedido
                setTimeout(() => {
                    showSection('login-section');
                    document.getElementById('email-login').value = email;
                }, 2000); // 2 segundos antes de mudar
            } catch (error) {
                cadastroMessage.textContent = 'Erro ao cadastrar usuário: ' + error.message;
            }
        });
        
        // Evento de submissão do formulário de recuperação de senha
        recoverForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('email-recover').value;
            
            try {
                recoverMessage.textContent = '';
                const resetUrl = window.location.href.replace('#', '') + '#reset-password';
                await account.createRecovery(email, resetUrl);
                recoverMessage.textContent = 'Se um e-mail com este endereço existir, um link de recuperação de senha foi enviado.';
            } catch (error) {
                recoverMessage.textContent = 'Erro ao enviar o link de recuperação: ' + error.message;
            }
        });

        // Evento de clique do botão de logout
        logoutButton.addEventListener('click', async () => {
            try {
                await account.deleteSession('current');
                showSection('login-section');
            } catch (error) {
                alert('Falha ao sair: ' + error.message);
            }
        });

        // Eventos para alternar entre as seções
        linkToSignup.addEventListener('click', (e) => {
            e.preventDefault();
            showSection('cadastro-section');
        });

        linkToLogin.addEventListener('click', (e) => {
            e.preventDefault();
            showSection('login-section');
        });

        linkToRecover.addEventListener('click', (e) => {
            e.preventDefault();
            showSection('recover-section');
        });
        
        linkToLoginFromRecover.addEventListener('click', (e) => {
            e.preventDefault();
            showSection('login-section');
        });

        // Chama a função para verificar o status de login ao carregar a página
        window.addEventListener('load', checkAuthStatus);
    </script>
</body>
</html>
